<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CoCurr Landing Page</title>
    <script type="module" src="firebaseauth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
    <script type="module">
    import { firebaseSignUp, firebaseLogin } from './firebaseauth.js';
    window.firebaseSignUp = firebaseSignUp;
    window.firebaseLogin = firebaseLogin;
  </script>
    <!--------------------------------------------------------------------------------------------------------------------------->
    <!----------                                              Google Fonts                                             ---------->
    <!--------------------------------------------------------------------------------------------------------------------------->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Reset -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html, body {
        width: 100%;
        height: 100%;
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
      }
      body {
        background: #f8f8f8;
        color: #333;
      }
      img {
        display: block;
        max-width: 100%;
        height: auto;
      }
      button {
        font-family: inherit;
        cursor: pointer;
      }
      .landing-page-container1 {/* Make the main landing page fill the browser */
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <!--------------------------------------------------------------------------------------------------------------------------->
    <!----------                                              FIREBASE                                                 ---------->
    <!--------------------------------------------------------------------------------------------------------------------------->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/VERSION/firebase-app.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use -->
  <!-- For Authentication -->
  <script src="https://www.gstatic.com/firebasejs/VERSION/firebase-auth.js"></script>
  <script>
    // Your custom Firebase project configuration object goes here
    const firebaseConfig = {
      apiKey: "AIzaSyBFD3eK8SmP4z_eXAoiPzNN0gRnhxyum-U",
      authDomain: "cocurr-sofeng.firebaseapp.com",
      databaseURL: "https://cocurr-sofeng-default-rtdb.firebaseio.com",
      projectId: "cocurr-sofeng",
      storageBucket: "cocurr-sofeng.firebasestorage.app",
      messagingSenderId: "387943862464",
      appId: "1:387943862464:web:d6f4f44572d6f571fadd25",
      measurementId: "G-69R2GW6RPB"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
    <!--------------------------------------------------------------------------------------------------------------------------->
    <!----------                                              GUI                                                      ---------->
    <!--------------------------------------------------------------------------------------------------------------------------->
    <div class="landing-page-container1">
      <img
        alt="background14"
        src="public/background14-k63n-1900w.png"
        class="landing-page-background"
        style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;"
      />
      <!-- Rounded rectangle background (hidden by default) -->
      <div id="bgRect" style="position:absolute; top:250px; left:435px; width:573px; height:289px; background-color:#ffffff; border-radius:30px; opacity:0; z-index:0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
      <!-- LOGO -->
      <img
        alt="CoCurrLogo13"
        src="public/cocurrlogo13-wk3a-200h.png"
        class="landing-page-co-curr-logo"
        style="position:absolute; top:300px; left:500px; width:auto; height:80px; z-index:1;"
      />
      <span class="cocurrtagline" style="position:absolute; top:400px; left:520px; font-size:2rem; color:#000000; font-family:'Fredoka', sans-serif; z-index:1;">
        <span>Coordinate your Curriculum</span>
      </span>
      <!--------------------------------------------------------------------------------------------------------------------------->
      <!----------                                     LOGIN/SIGNUP BUTTON                                               ---------->
      <!--------------------------------------------------------------------------------------------------------------------------->
      <button class="landing-page-button1" id= "logInBtn" style="position:absolute;font-size:20px; top:470px; left:800px; background-color:#fff; color:#000000; padding:20px 24px; border-radius:20px; border:none; font-family:'Hanken Grotesk', sans-serif;">Log In</button>
      <button class="landing-page-button2" id="signUpBtn" style="position:absolute;font-size:20px; top:470px; left:544px; background-color:#fff; color:#000000; padding:20px 24px; border-radius:20px; border:none; font-family:'Hanken Grotesk', sans-serif;">Sign Up</button>
      </div>
      <!--------------------------------------------------------------------------------------------------------------------------->
      <!----------                                              PW/EMAIL                                                 ---------->
      <!--------------------------------------------------------------------------------------------------------------------------->
        <span class="emailtitle" style="position:absolute; top:260px; left:460px; font-size:1.5rem; color:#000000; font-family:'Fredoka', sans-serif; z-index:10; opacity:0;">Email</span>
        <span class="pwtitle" style="position:absolute; top:360px; left:460px; font-size:1.5rem; color:#000000; font-family:'Fredoka', sans-serif; z-index:10; opacity:0;">Password</span>
        <input type="email" id="emailInput" name="email" placeholder="Enter your email" style="position:absolute; top:310px; left:460px; padding:12px; border-radius:6px; border:1px solid #aaa; width:500px; font-family:'Fredoka', sans-serif; z-index:10; opacity:0;" required>
        <input type="password" id="passwordInput" name="password" placeholder="Enter your password" style="position:absolute; top:410px; left:460px; padding:12px; border-radius:6px; border:1px solid #aaa; width:500px; font-family:'Fredoka', sans-serif; z-index:10; opacity:0;" required>
        <span class="pwcaption" style="position:absolute; top:500px; left:460px; font-size:1rem; color:#000000; font-family:'Fredoka', sans-serif; z-index:10; opacity:0;">Enter your password</span>
        <span class="emailcaption" style="position:absolute; top:500px; left:460px; font-size:1rem; color:#000000; font-family:'Fredoka', sans-serif; z-index:10; opacity:0;">Enter your email</span>
      <!--------------------------------------------------------------------------------------------------------------------------->
      <!----------                                              INIT                                                     ---------->
      <!--------------------------------------------------------------------------------------------------------------------------->
    <script>
      const signUpBtn = document.getElementById('signUpBtn');
      const logInBtn = document.getElementById('logInBtn');
      const logo = document.querySelector('.landing-page-co-curr-logo');
      const text = document.querySelector('.cocurrtagline');
      const bgRect = document.getElementById('bgRect');
      const pwtitle = document.querySelector('.pwtitle');
      const emailtitle = document.querySelector('.emailtitle');
      const emailInput = document.getElementById('emailInput');
      const passwordInput = document.getElementById('passwordInput');
      const emailcaption = document.querySelector('.emailcaption');
      const pwcaption = document.querySelector('.pwcaption');
      let formVisible = false; // tracks whether inputs are shown

      // Basic client-side email format check
      function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function showFieldError(inputEl, captionEl, message) {
        inputEl.style.borderColor = '#e74c3c';
        captionEl.textContent = message;
        captionEl.style.color = '#e74c3c';
        captionEl.style.opacity = '1';
      }

      function clearFieldError(inputEl, captionEl) {
        inputEl.style.borderColor = '#aaa';
        captionEl.textContent = '';
        captionEl.style.opacity = '0';
      }

      signUpBtn.addEventListener('click', function() {
        if (!formVisible) {
          // First click: show the form inside the rectangle
          bgRect.style.transition = 'opacity 0.6s ease-in-out';
          bgRect.style.opacity = '1';
          emailtitle.style.transition = 'opacity 0.6s ease-in-out';
          emailtitle.style.opacity = '1';
          pwtitle.style.transition = 'opacity 0.6s ease-in-out';
          pwtitle.style.opacity = '1';
          emailInput.style.transition = 'opacity 0.6s ease-in-out';
          emailInput.style.opacity = '1';
          passwordInput.style.transition = 'opacity 0.6s ease-in-out';
          passwordInput.style.opacity = '1';

          // Animate logo moving up
          logo.style.transition = 'top 0.6s ease-in-out';
          logo.style.top = '80px';
          // Animate text moving up
          text.style.transition = 'top 0.6s ease-in-out';
          text.style.top = '180px';
          // Move Sign Up button down below the rectangle and center it
          signUpBtn.style.transition = 'top 0.6s ease-in-out, left 0.6s ease-in-out';
          signUpBtn.style.top = '570px';
          signUpBtn.style.left = '47%';
          signUpBtn.style.transform = 'translateX(-50%)';
          // Hide Log In button
          logInBtn.style.transition = 'opacity 0.6s ease-in-out';
          logInBtn.style.opacity = '0';

          formVisible = true;
          // update label so user knows next press will submit
          signUpBtn.dataset.originalText = signUpBtn.textContent;
          signUpBtn.textContent = 'Sign In';
        } else {
          // Second click: validate before navigating
          const emailVal = (emailInput.value || '').trim();
          const pwVal = (passwordInput.value || '').trim();
          // clear previous errors
          clearFieldError(emailInput, emailcaption);
          clearFieldError(passwordInput, pwcaption);

          if (!emailVal) {
            showFieldError(emailInput, emailcaption, 'Email is required');
            emailInput.focus();
            return;
          }
          if (!isValidEmail(emailVal)) {
            showFieldError(emailInput, emailcaption, 'Please enter a valid email');
            emailInput.focus();
            return;
          }
          if (!pwVal) {
            showFieldError(passwordInput, pwcaption, 'Password is required');
            passwordInput.focus();
            return;
          }

          // All client-side checks passed — proceed to homepage
          firebaseSignUp(emailVal, pwVal);
          //window.location.href = '../cocurr-homepage/homepage.html';
        }
      });
      
      logInBtn.addEventListener('click', function() {
        if (!formVisible) {
          bgRect.style.transition = 'opacity 0.6s ease-in-out';
          bgRect.style.opacity = '1';
          emailtitle.style.transition = 'opacity 0.6s ease-in-out';
          emailtitle.style.opacity = '1';
          pwtitle.style.transition = 'opacity 0.6s ease-in-out';
          pwtitle.style.opacity = '1';
          emailInput.style.transition = 'opacity 0.6s ease-in-out';
          emailInput.style.opacity = '1';
          passwordInput.style.transition = 'opacity 0.6s ease-in-out';
          passwordInput.style.opacity = '1';
          // Animate logo moving up
          logo.style.transition = 'top 0.6s ease-in-out';
          logo.style.top = '80px';
          // Animate text moving up
          text.style.transition = 'top 0.6s ease-in-out';
          text.style.top = '180px';
          // Move Log In button down below the rectangle and center it
          logInBtn.style.transition = 'top 0.6s ease-in-out, left 0.6s ease-in-out';
          logInBtn.style.top = '570px';
          logInBtn.style.left = '47%';
          logInBtn.style.transform = 'translateX(-50%)';
          // Hide Sign Up button
          signUpBtn.style.transition = 'opacity 0.6s ease-in-out';
          signUpBtn.style.opacity = '0';

          formVisible = true;
          logInBtn.dataset.originalText = logInBtn.textContent;
          logInBtn.textContent = 'Sign In';
        } else {
          // validate before sending to server
          const emailVal = (emailInput.value || '').trim();
          const pwVal = (passwordInput.value || '').trim();
          clearFieldError(emailInput, emailcaption);
          clearFieldError(passwordInput, pwcaption);
          if (!emailVal) {
            showFieldError(emailInput, emailcaption, 'Email is required');
            emailInput.focus();
            return;
          }
          if (!isValidEmail(emailVal)) {
            showFieldError(emailInput, emailcaption, 'Please enter a valid email');
            emailInput.focus();
            return;
          }
          if (!pwVal) {
            showFieldError(passwordInput, pwcaption, 'Password is required');
            passwordInput.focus();
            return;
          }

          // send credentials to server for verification
          fetch('../cocurr/login.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: emailVal, password: pwVal }),
            credentials: 'include'
          })
          .then(r => r.json().then(j => ({ status: r.status, json: j })))
          .then(({ status, json }) => {
            if (status === 200 && json.ok) {
              // successful login — redirect to homepage
              //window.location.href = '../cocurr-homepage/homepage.html';
              firebaseLogin(emailVal, pwVal);
            } else {
              // show error returned by server
              const message = json && json.error ? json.error : 'Login failed';
              showFieldError(passwordInput, pwcaption, message);
            }
          })
          .catch(err => {
            showFieldError(passwordInput, pwcaption, 'Network or server error');
            console.error(err);
          });
        }
      });


    </script>
  </body>
</html>